<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pengurusan Asrama SK Batu Niah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Transisi untuk dropdown */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800 font-sans">

<div id="app" class="flex flex-col min-h-screen">

    <header class="bg-blue-900 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" @click="goHome">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-900 font-bold border-2 border-yellow-400">SK</div>
                <div><h1 class="font-bold leading-tight">SK BATU NIAH</h1><p class="text-xs text-blue-200">e-Asrama (Online)</p></div>
            </div>
            <div v-if="currentUser.role === 'admin'" class="flex items-center gap-3">
                <span class="text-xs bg-blue-800 px-2 py-1 rounded hidden md:block">{{ currentUser.name }}</span>
                <button @click="logout" class="text-xs bg-red-600 hover:bg-red-700 px-3 py-1 rounded">Keluar</button>
            </div>
            <div v-else-if="currentView !== 'login_selection'">
                <button @click="goHome" class="text-sm hover:text-gray-300"><i class="fa-solid fa-house"></i> Utama</button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4 py-8">
        
        <div v-if="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-5 rounded-lg flex items-center gap-3 shadow-xl">
                <div class="loader"></div>
                <span class="font-semibold text-gray-700">Sedang memproses data...</span>
            </div>
        </div>

        <div v-if="currentView === 'login_selection'" class="flex flex-col items-center justify-center min-h-[60vh]">
            <h2 class="text-3xl font-bold text-blue-900 mb-8 text-center">Sistem Permohonan Asrama</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-600">
                    <h3 class="text-xl font-bold mb-4 text-center text-blue-900"><i class="fa-solid fa-user-shield mr-2"></i>Unit Pengurusan</h3>
                    <form @submit.prevent="adminLogin" class="space-y-3">
                        <input v-model="loginForm.id" type="text" placeholder="ID Pengguna" class="w-full border p-2 rounded">
                        <input v-model="loginForm.pass" type="password" placeholder="Kata Laluan" class="w-full border p-2 rounded">
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 font-bold">Log Masuk</button>
                    </form>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500">
                    <h3 class="text-xl font-bold mb-4 text-center text-green-800"><i class="fa-solid fa-users mr-2"></i>Ibu Bapa / Penjaga</h3>
                    <form @submit.prevent="parentCheck" class="space-y-3">
                        <input v-model="parentSearchIC" type="text" placeholder="No. MyKid / Sijil Lahir Anak" class="w-full border p-2 rounded">
                        <p class="text-xs text-gray-400">Contoh: 130525-13-0541 atau SK 57743</p>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 font-bold">Semak Status</button>
                    </form>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'admin_dashboard'">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded shadow border-l-4 border-blue-500">
                    <p class="text-xs font-bold text-gray-500">JUMLAH PEMOHON</p>
                    <p class="text-2xl font-bold">{{ students.length }}</p>
                </div>
                <div class="bg-white p-4 rounded shadow border-l-4 border-green-500">
                    <p class="text-xs font-bold text-gray-500">DITERIMA</p>
                    <p class="text-2xl font-bold">{{ countStatus('Diterima') }}</p>
                </div>
                <div class="bg-white p-4 rounded shadow border-l-4 border-yellow-500">
                    <p class="text-xs font-bold text-gray-500">SIMPANAN</p>
                    <p class="text-2xl font-bold">{{ countStatus('Simpanan') }}</p>
                </div>
                <div class="bg-white p-4 rounded shadow cursor-pointer hover:bg-blue-50" @click="fetchStudents">
                    <p class="text-xs font-bold text-gray-500">DATABASE</p>
                    <p class="text-sm font-bold text-blue-600 mt-1"><i class="fa-solid fa-rotate mr-1"></i> Refresh Data</p>
                </div>
            </div>

            <div class="flex border-b mb-4">
                <button @click="activeTab = 'list'" :class="activeTab === 'list' ? 'border-blue-600 text-blue-600' : 'text-gray-500'" class="px-4 py-2 border-b-2 font-medium">Senarai Pelajar</button>
                <button @click="activeTab = 'add'" :class="activeTab === 'add' ? 'border-blue-600 text-blue-600' : 'text-gray-500'" class="px-4 py-2 border-b-2 font-medium">Key-in Baru</button>
            </div>

            <div v-if="activeTab === 'list'" class="bg-white rounded shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2 text-left">Pelajar</th>
                            <th class="px-4 py-2 text-left">Waris & Tel</th>
                            <th class="px-4 py-2 text-left">Kesihatan</th>
                            <th class="px-4 py-2 text-left">Status</th>
                            <th class="px-4 py-2 text-left">Tindakan</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <tr v-for="std in students" :key="std.ic">
                            <td class="px-4 py-3">
                                <div class="font-bold">{{ std.nama }}</div>
                                <div class="text-xs text-gray-500">{{ std.ic }}</div>
                                <div class="text-xs text-blue-600">{{ std.kelas }} ({{ std.jantina }})</div>
                                <div class="text-xs text-gray-400 italic">Agama: {{ std.agama }}</div>
                            </td>
                            <td class="px-4 py-3">
                                <div>{{ std.namaBapa }}</div>
                                <div class="font-mono text-xs">{{ std.noTel }}</div>
                            </td>
                            <td class="px-4 py-3">
                                <div v-if="std.alahan && std.alahan !== 'Tiada'" class="text-red-600 text-xs font-bold">Alahan: {{ std.alahan }}</div>
                                <div v-if="std.penyakit && std.penyakit !== 'Tiada'" class="text-orange-600 text-xs font-bold">Penyakit: {{ std.penyakit }}</div>
                                <div v-if="(!std.alahan || std.alahan === 'Tiada') && (!std.penyakit || std.penyakit === 'Tiada')" class="text-gray-400 text-xs">Tiada Rekod</div>
                            </td>
                            <td class="px-4 py-3">
                                <span :class="badgeColor(std.status)" class="px-2 py-1 rounded text-xs font-bold">{{ std.status }}</span>
                            </td>
                            <td class="px-4 py-3 flex gap-2">
                                <button @click="updateStatus(std, 'Diterima')" class="bg-green-100 text-green-700 p-1 rounded hover:bg-green-200" title="Terima"><i class="fa-solid fa-check"></i></button>
                                <button @click="updateStatus(std, 'Simpanan')" class="bg-yellow-100 text-yellow-700 p-1 rounded hover:bg-yellow-200" title="KIV"><i class="fa-solid fa-clock"></i></button>
                                <button @click="updateStatus(std, 'Ditolak')" class="bg-red-100 text-red-700 p-1 rounded hover:bg-red-200" title="Tolak"><i class="fa-solid fa-times"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div v-if="activeTab === 'add'" class="bg-white p-6 rounded shadow max-w-3xl mx-auto">
                <h3 class="font-bold text-lg mb-4 text-gray-700 border-b pb-2">Borang Pendaftaran</h3>
                <form @submit.prevent="submitStudent" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="col-span-2 md:col-span-1 space-y-4">
                        <div class="bg-blue-50 p-3 rounded border border-blue-100">
                            <h4 class="font-bold text-blue-700 text-sm mb-3">Maklumat Pelajar</h4>
                            
                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Nama Penuh</label>
                                <input v-model="form.nama" placeholder="HURUF BESAR" required class="w-full border p-2 rounded uppercase text-sm">
                            </div>

                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">No. MyKid / Sijil Lahir / ID</label>
                                <input v-model="form.ic" @blur="autoDetectGender" placeholder="Cth: 130525-13-0541 atau SK 57743" required class="w-full border p-2 rounded text-sm">
                                <p class="text-[10px] text-gray-400 mt-1">Format: 000000-00-0000 atau SK 00000</p>
                            </div>

                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Jantina</label>
                                <select v-model="form.jantina" class="w-full border p-2 rounded text-sm bg-white">
                                    <option value="" disabled>Sila Pilih</option>
                                    <option value="Lelaki">Lelaki</option>
                                    <option value="Perempuan">Perempuan</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Kelas</label>
                                <select v-model="form.kelas" class="w-full border p-2 rounded text-sm bg-white">
                                    <option value="" disabled>Sila Pilih Kelas</option>
                                    <option v-for="cls in generatedClasses" :key="cls" :value="cls">{{ cls }}</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Agama</label>
                                <select v-model="form.agama" class="w-full border p-2 rounded text-sm bg-white">
                                    <option>Islam</option>
                                    <option>Kristian</option>
                                    <option>Buddha</option>
                                    <option>Hindu</option>
                                    <option>Lain-lain</option>
                                </select>
                                <input v-if="form.agama === 'Lain-lain'" v-model="form.customAgama" placeholder="Nyatakan Agama..." class="w-full border p-2 rounded text-sm mt-2 bg-yellow-50">
                            </div>

                            <div>
                                <label class="text-xs font-bold text-gray-600">Alamat Penuh</label>
                                <textarea v-model="form.alamat" rows="2" class="w-full border p-2 rounded text-sm"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-2 md:col-span-1 space-y-4">
                        
                        <div class="bg-gray-50 p-3 rounded border border-gray-200">
                            <h4 class="font-bold text-gray-700 text-sm mb-3">Maklumat Waris</h4>
                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Nama Bapa/Penjaga</label>
                                <input v-model="form.namaBapa" required class="w-full border p-2 rounded text-sm uppercase">
                            </div>
                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">No. KP Bapa</label>
                                <input v-model="form.icBapa" class="w-full border p-2 rounded text-sm">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-600">No. Telefon (Wajib)</label>
                                <input v-model="form.noTel" required placeholder="Cth: 011-1234567" class="w-full border p-2 rounded text-sm">
                            </div>
                        </div>

                        <div class="bg-red-50 p-3 rounded border border-red-100">
                            <h4 class="font-bold text-red-700 text-sm mb-3">Rekod Kesihatan</h4>
                            
                            <div class="mb-3">
                                <label class="text-xs font-bold text-gray-600">Penyakit Kronik</label>
                                <div class="flex gap-2 mb-2">
                                    <select v-model="form.penyakit" class="w-full border p-2 rounded text-sm bg-white">
                                        <option v-for="d in diseaseList" :key="d" :value="d">{{ d }}</option>
                                    </select>
                                </div>
                                <div class="flex gap-1">
                                    <input v-model="newDiseaseInput" placeholder="Tambah penyakit baru..." class="border p-1 rounded text-xs flex-grow">
                                    <button type="button" @click="addToList('disease')" class="bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700">Tambah</button>
                                </div>
                            </div>

                            <div>
                                <label class="text-xs font-bold text-gray-600">Alahan Makanan/Ubat</label>
                                <div class="flex gap-2 mb-2">
                                    <select v-model="form.alahan" class="w-full border p-2 rounded text-sm bg-white">
                                        <option v-for="a in allergyList" :key="a" :value="a">{{ a }}</option>
                                    </select>
                                </div>
                                <div class="flex gap-1">
                                    <input v-model="newAllergyInput" placeholder="Tambah alahan baru..." class="border p-1 rounded text-xs flex-grow">
                                    <button type="button" @click="addToList('allergy')" class="bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700">Tambah</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="col-span-2 bg-blue-600 text-white font-bold py-3 rounded shadow hover:bg-blue-700 mt-4 flex justify-center items-center gap-2">
                        <i class="fa-solid fa-save"></i> SIMPAN MAKLUMAT PELAJAR
                    </button>
                </form>
            </div>
        </div>

        <div v-if="currentView === 'parent_result'" class="flex justify-center">
            <div class="bg-white w-full max-w-2xl p-8 rounded shadow-xl border-t-8 border-blue-900">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold">Keputusan Permohonan Asrama</h2>
                    <p class="text-gray-500 mt-1">{{ selectedStudent.nama }}</p>
                    <p class="text-sm font-mono text-gray-400">{{ selectedStudent.ic }}</p>
                </div>
                <div class="flex justify-center mb-8">
                    <div v-if="selectedStudent.status === 'Diterima'" class="bg-green-100 text-green-800 px-8 py-4 rounded-lg font-bold text-xl border border-green-300 flex items-center gap-3">
                        <i class="fa-solid fa-check-circle text-2xl"></i> DITERIMA
                    </div>
                    <div v-else-if="selectedStudent.status === 'Ditolak'" class="bg-red-100 text-red-800 px-8 py-4 rounded-lg font-bold text-xl border border-red-300">
                        <i class="fa-solid fa-times-circle mr-2"></i> TIDAK BERJAYA
                    </div>
                    <div v-else class="bg-yellow-100 text-yellow-800 px-8 py-4 rounded-lg font-bold text-xl border border-yellow-300">
                        <i class="fa-solid fa-hourglass-half mr-2"></i> DALAM PROSES
                    </div>
                </div>
                <div v-if="selectedStudent.status === 'Diterima'" class="space-y-3">
                    <button @click="printLetter(selectedStudent)" class="w-full bg-blue-700 text-white font-bold py-3 rounded shadow hover:bg-blue-800 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-print"></i> CETAK SURAT TAWARAN
                    </button>
                </div>
                <button @click="currentView = 'login_selection'; parentSearchIC=''" class="mt-6 w-full text-gray-500 py-2 hover:text-gray-800 underline">Kembali</button>
            </div>
        </div>

    </main>
</div>

<script>
    // --- MASUKKAN URL GOOGLE APPS SCRIPT ANDA DI SINI ---
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby8Ma7jeS5enVHS2gKreS4OaRhqVCj157MTp-AESpVu8ZayQvrSJRSIRiinSKASXvMq/exec'; 

    const { createApp } = Vue;
    const { jsPDF } = window.jspdf;

    createApp({
        data() {
            return {
                currentView: 'login_selection',
                activeTab: 'list',
                isLoading: false,
                loginForm: { id: '', pass: '' },
                currentUser: { role: '', name: '' },
                parentSearchIC: '',
                students: [],
                selectedStudent: null,
                
                // DATA BORANG BARU
                form: {
                    nama: '', ic: '', kelas: '', jantina: '', agama: 'Islam', customAgama: '',
                    alamat: '', namaBapa: '', icBapa: '', noTel: '', 
                    alahan: 'Tiada', penyakit: 'Tiada'
                },

                // LIST DROPDOWN
                generatedClasses: [],
                diseaseList: ['Tiada', 'Asma', 'Jantung Berlubang', 'Sawan', 'Eczema'],
                allergyList: ['Tiada', 'Makanan Laut (Seafood)', 'Kekacang', 'Telur', 'Habuk', 'Ubat-ubatan'],
                newDiseaseInput: '',
                newAllergyInput: ''
            }
        },
        mounted() {
            this.generateClassList();
        },
        methods: {
            goHome() {
                this.currentView = 'login_selection';
                this.currentUser = { role: '', name: '' };
            },
            
            // --- LOGIK GENERATE KELAS ---
            generateClassList() {
                const years = ['1', '2', '3', '4', '5', '6'];
                const names = ['Cemerlang', 'Gemilang'];
                this.generatedClasses = [];
                years.forEach(y => {
                    names.forEach(n => {
                        this.generatedClasses.push(`${y} ${n}`);
                    });
                });
            },

            // --- LOGIK AUTO JANTINA DARI IC ---
            autoDetectGender() {
                const ic = this.form.ic.replace(/[^0-9]/g, ''); // Ambil nombor sahaja
                
                [cite_start]// Jika format 12 digit (Standard MyKid/MyKad) [cite: 1]
                if (ic.length === 12) {
                    const lastDigit = parseInt(ic.slice(-1));
                    [cite_start]// Ganjil = Lelaki, Genap = Perempuan [cite: 1]
                    if (lastDigit % 2 !== 0) {
                        this.form.jantina = 'Lelaki';
                    } else {
                        this.form.jantina = 'Perempuan';
                    }
                }
            },

            // --- LOGIK TAMBAH LIST DYNAMIC (PENYAKIT/ALAHAN) ---
            addToList(type) {
                let val = type === 'disease' ? this.newDiseaseInput.trim() : this.newAllergyInput.trim();
                let list = type === 'disease' ? this.diseaseList : this.allergyList;

                if (!val) return;

                // Cek Duplicate (Case insensitive)
                const exists = list.some(item => item.toLowerCase() === val.toLowerCase());
                
                if (exists) {
                    alert(`Item "${val}" sudah ada dalam senarai!`);
                } else {
                    list.push(val); // Tambah ke dropdown
                    // Auto select item yang baru ditambah
                    if (type === 'disease') {
                        this.form.penyakit = val;
                        this.newDiseaseInput = '';
                    } else {
                        this.form.alahan = val;
                        this.newAllergyInput = '';
                    }
                }
            },

            // --- API CONNECT ---
            async fetchStudents() {
                if (GAS_URL.includes('LETAKKAN')) {
                    alert('Sila masukkan URL Google Script dalam kod HTML dahulu!');
                    return;
                }
                this.isLoading = true;
                try {
                    const res = await fetch(GAS_URL + '?action=read');
                    const json = await res.json();
                    if (json.result === 'success') {
                        this.students = json.data;
                        
                        // --- SMART LIST FEATURE ---
                        // Scan database pelajar sedia ada untuk update dropdown
                        this.students.forEach(s => {
                            if (s.penyakit && !this.diseaseList.includes(s.penyakit)) this.diseaseList.push(s.penyakit);
                            if (s.alahan && !this.allergyList.includes(s.alahan)) this.allergyList.push(s.alahan);
                        });
                    }
                } catch (e) {
                    alert('Gagal menyambung ke database. Sila refresh.');
                    console.error(e);
                } finally {
                    this.isLoading = false;
                }
            },

            async submitStudent() {
                // Validasi Format IC
                // Format A: 12 digit (dengan atau tanpa sengkang)
                // Format B: SK diikuti 5 digit
                const icRegexA = /^\d{6}-?\d{2}-?\d{4}$/; // Standard
                const icRegexB = /^SK\s?\d{5}$/i; // Format SK
                
                if (!icRegexA.test(this.form.ic) && !icRegexB.test(this.form.ic)) {
                    alert('Format No. ID salah! Sila guna format:\n1. 000000-00-0000 (MyKid)\n2. SK 00000 (Lain-lain)');
                    return;
                }

                // Handle Agama Lain-lain
                let finalAgama = this.form.agama;
                if (this.form.agama === 'Lain-lain') {
                    if (!this.form.customAgama) {
                        alert('Sila nyatakan agama jika memilih "Lain-lain"');
                        return;
                    }
                    finalAgama = this.form.customAgama;
                }

                this.isLoading = true;
                const params = new URLSearchParams();
                params.append('action', 'insert');
                
                // Copy form data to params
                for (const key in this.form) {
                    if (key !== 'customAgama') { // Skip field helper
                         // Jika agama, guna finalAgama yg diproses
                        params.append(key, key === 'agama' ? finalAgama : this.form[key]);
                    }
                }
                params.append('status', 'Baru');

                try {
                    await fetch(GAS_URL, { method: 'POST', body: params });
                    alert('Data berjaya disimpan!');
                    // Reset Form
                    this.form = {
                        nama: '', ic: '', kelas: '', jantina: '', agama: 'Islam', customAgama: '',
                        alamat: '', namaBapa: '', icBapa: '', noTel: '', alahan: 'Tiada', penyakit: 'Tiada'
                    };
                    this.fetchStudents(); // Refresh data
                    this.activeTab = 'list';
                } catch (e) {
                    alert('Ralat menyimpan data.');
                } finally {
                    this.isLoading = false;
                }
            },

            async updateStatus(std, newStatus) {
                if(!confirm(`Tukar status ${std.nama} kepada ${newStatus}?`)) return;
                this.isLoading = true;
                const oldStatus = std.status;
                std.status = newStatus;
                try {
                    const response = await fetch(`${GAS_URL}?action=updateStatus&ic=${std.ic}&status=${newStatus}`);
                } catch (e) {
                    console.error(e);
                } finally {
                    this.isLoading = false;
                }
            },

            // --- LOGIN ---
            async adminLogin() {
                if (this.loginForm.id === '01115864913' && this.loginForm.pass === '01115864913') {
                    this.currentUser = { role: 'admin', name: 'Penyelia Asrama' };
                    this.currentView = 'admin_dashboard';
                    await this.fetchStudents();
                } else if (this.loginForm.pass === 'Ybb4412') {
                    this.currentUser = { role: 'admin', name: 'Unit Pengurusan' };
                    this.currentView = 'admin_dashboard';
                    await this.fetchStudents();
                } else {
                    alert('Login Salah.');
                }
            },

            // --- PARENT CHECK ---
            async parentCheck() {
                if (!this.students.length) await this.fetchStudents();
                
                // Logik carian fleksibel (buang sengkang & whitespace)
                const input = this.parentSearchIC.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
                
                const found = this.students.find(s => {
                    const dbIC = String(s.ic).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
                    return dbIC === input;
                });
                
                if (found) {
                    this.selectedStudent = found;
                    this.currentView = 'parent_result';
                } else {
                    alert('Rekod tidak dijumpai. Sila pastikan ejaan No KP betul.');
                }
            },

            countStatus(st) { return this.students.filter(s => s.status === st).length; },
            badgeColor(st) {
                if(st==='Diterima') return 'bg-green-100 text-green-800';
                if(st==='Ditolak') return 'bg-red-100 text-red-800';
                return 'bg-yellow-100 text-yellow-800';
            },

            // --- PDF PRINTING (SURAT TAWARAN) ---
            printLetter(std) {
                const doc = new jsPDF();
                
                // HEADER
                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text("SEKOLAH KEBANGSAAN BATU NIAH", 105, 20, null, null, "center");
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text("D/A PEJABAT PENDIDIKAN DAERAH SUBIS, 98150 BEKENU", 105, 26, null, null, "center");
                doc.text("Tel: 085-737-005 | E-mel: skbatuniah@gmail.com", 105, 31, null, null, "center");
                doc.setLineWidth(0.5); doc.line(20, 35, 190, 35);

                // KANDUNGAN
                doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 150, 45);
                doc.text(`Kepada: ${std.namaBapa}`, 20, 55);
                doc.text(std.alamat || '', 20, 60);

                doc.setFont("helvetica", "bold");
                doc.text("TAWARAN MASUK KE ASRAMA", 20, 80);
                
                doc.setFont("helvetica", "normal");
                const text = `Sukacita dimaklumkan bahawa anak tuan/puan, ${std.nama} (${std.ic}), telah berjaya ditawarkan tempat di asrama SK Batu Niah.`;
                doc.text(doc.splitTextToSize(text, 170), 20, 90);
                
                doc.text("Sila bawa surat ini dan keperluan asrama semasa hari pendaftaran.", 20, 110);
                
                doc.setFont("helvetica", "bold");
                doc.text("GURU BESAR", 20, 140);
                doc.text("SK Batu Niah", 20, 145);

                doc.autoPrint();
                window.open(doc.output('bloburl'), '_blank');
            }
        }
    }).mount('#app');
</script>
</body>
</html>